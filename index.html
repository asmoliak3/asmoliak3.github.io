<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pushwoosh Web Push Demo</title>

  <!-- 1) Подключаем Web Push SDK из CDN асинхронно -->
  <script async src="//cdn.pushwoosh.com/webpush/v3/pushwoosh-web-notifications.js"></script>

  <script>
    // 2) Инициализируем Pushwoosh SDK сразу после загрузки скрипта
    //    Обязательно указываем правильные applicationCode и apiToken из вашего Control Panel
    var Pushwoosh = Pushwoosh || [];
    Pushwoosh.push(['init', {
      logLevel: 'info',
      applicationCode: '9627A-C956D',  // ваш код приложения
      apiToken: 'YOtYgEuAX00Dgs81J6EkY1MFBvQnHOGb2GzRy6MjNaaBHuILH2fdqrE7UcnmICvYDAf24vLAOWNvHkH4GQqd5',
      safariWebsitePushID: 'web.com.example.domain', // любое значение, если вы не настраивали Safari Push. Можно оставить пустым или mock-значение.
      autoSubscribe: false,
      subscribeWidget: { enable: true }
    }]);

    // 3) Ждём, пока SDK полностью загрузится, и регистрируем service worker
    Pushwoosh.push(['onLoad', function(api) {
      // Здесь SDK уже готов к работе
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/pushwoosh-service-worker.js')
          .then(function(reg) {
            console.log('Service worker для Pushwoosh успешно зарегистрирован:', reg);
          })
          .catch(function(err) {
            console.error('Не удалось зарегистрировать service worker:', err);
          });
      }
    }]);
  </script>
</head>
<body>
  <h1>Pushwoosh Web Push Demo</h1>

  <!-- 4) Кнопка, которая вручную вызывает подписку -->
  <button id="subscribe-btn">Подписаться на уведомления</button>

  <script>
    // 5) Вешаем обработчик нажатия: вместо Pushwoosh.push(['subscribe'])
    //    напрямую вызываем Pushwoosh.subscribe()
    document.getElementById('subscribe-btn').addEventListener('click', function() {
      Pushwoosh.subscribe()
        .then(function() {
          // Если подписка прошла успешно, можно вывести что-нибудь в консоль
          console.log('Запрос на разрешение отправлен (Pushwoosh.subscribe).');
        })
        .catch(function(err) {
          console.error('Ошибка при вызове Pushwoosh.subscribe():', err);
        });
    });
  </script>
</body>
</html>
