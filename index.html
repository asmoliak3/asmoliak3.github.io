<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Pushwoosh Web Push Demo</title>

  <!-- 1) Подключаем Web Push SDK из CDN -->
  <script async src="//cdn.pushwoosh.com/webpush/v3/pushwoosh-web-notifications.js"></script>

  <script>
    // 2) Инициализируем Pushwoosh Web SDK (минимальный набор параметров).
    //    Ниже именно то, что нужно: applicationCode, apiToken и отключение inbox.
    var Pushwoosh = Pushwoosh || [];
    Pushwoosh.push(['init', {
      // Ваш Application Code (Control Panel → Settings → General)
      applicationCode: '9627A-C956D',

      // Ваш Device API Token (Control Panel → Settings → API Access → Web Push)
      apiToken: 'YOtYgEuAX00Dgs81J6EkY1MFBvQnHOGb2GzRy6MjNaaBHuILH2fdqrE7UcnmICvYDAf24vLAOWNvHkH4GQqd5',

      // Мы отключаем автоматическую подписку, чтобы пуш запрашивался только по нажатию кнопки
      autoSubscribe: false,

      // Не указываем safariWebsitePushID (иначе потребовал бы .p12-ключ и пароль)
      safariWebsitePushID: '',

      // Отключаем Inbox (иначе SDK будет пытаться выполнять getInboxMessages → 401)
      inboxWidget: { enable: false }
    }]);
  </script>
</head>
<body>
  <h1>Pushwoosh Web Push Demo</h1>

  <!-- 3) Простая кнопка для ручного запроса разрешения на пуши -->
  <button id="subscribe-btn"
          style="font-size: 16px; padding: 6px 12px; cursor: pointer;">
    Подписаться на уведомления
  </button>

  <script>
    // 4) Слушаем клик по кнопке и вызываем именно Pushwoosh.subscribe()
    document.getElementById('subscribe-btn').addEventListener('click', function() {
      // Вместо "Pushwoosh.push(['subscribe'])" используем "Pushwoosh.subscribe()"
      Pushwoosh.subscribe();
    });
  </script>

  <!-- 5) Регистрируем сервис-воркер из файла pushwoosh-service-worker.js в корне сайта -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/pushwoosh-service-worker.js')
          .then(function(reg) {
            console.log('Service worker зарегистрирован:', reg);
          })
          .catch(function(err) {
            console.error('Не удалось зарегистрировать service worker:', err);
          });
      });
    }
  </script>
</body>
</html>
